{{/* Hugo Blox: pubs-embed (custom) */}}

{{ $page := .wcPage }}
{{ $block := .wcBlock }}

{{ $bib := $block.content.bib | default "/bib/references.bib" }}
{{ $latest := $block.content.latest | default 3 }}
{{ $key := $block.content.key }}
{{ $keys := $block.content.keys }}

{{/* Heading (match Collection block styling) */}}
{{ if $block.content.title }}
<div class="flex flex-col items-center max-w-prose mx-auto gap-1 justify-center px-6 md:px-0">
  <div class="mb-6 text-3xl font-bold text-gray-900 dark:text-white">
    {{ $block.content.title | emojify | $page.RenderString }}
  </div>
  {{ with $block.content.text }}
    <p>{{ . | emojify | $page.RenderString }}</p>
  {{ end }}
</div>
{{ end }}

<div class="flex flex-col items-center px-6">
  <div class="w-full max-w-screen-lg">
      <div class="pub-embed"
         data-bib="{{ $bib }}"
         data-latest="{{ $latest }}"
         {{ with $key }}data-key="{{ . }}"{{ end }}
         {{ with $keys }}data-keys="{{ . }}"{{ end }}>
      <em class="opacity-70">Loading publicationsâ€¦</em>
    </div>
    </div>
  </div>

{{ with $block.content.archive }}
  {{ if .enable }}
    {{ $archive_link := .link | default "/publications/" }}
    {{ $archive_text := .text | default "See all" }}
    {{ $archive_icon := .icon | default "" }}

    <div class="mt-3 text-center">
      <a
        href="{{ $archive_link | relLangURL }}"
        class="group inline-flex items-center gap-2 rounded-lg bg-primary-600 px-6 py-3 text-base text-white shadow-md transition-all duration-300 hover:bg-primary-700 hover:shadow-lg focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600">

        <span>{{ $archive_text | emojify }}</span>

        {{ if $archive_icon }}
          <span class="inline-flex items-center justify-center transition-transform duration-300 group-hover:translate-x-1">
            {{ partial "functions/get_icon" (dict "name" $archive_icon "attributes" "class=\"w-5 h-5\"") }}
          </span>
        {{ end }}

      </a>
    </div>
  {{ end }}
{{ end }}



{{/* Load JS once per page */}}
{{ if not ($page.Store.Get "pubs_embed_loaded") }}
  {{ $page.Store.Set "pubs_embed_loaded" true }}
  <script src="/js/pubs-embed.js" defer></script>
{{ end }}
